<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Shoe API</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="navbar-brand">üëü Shoe API - Admin</a>
            <div class="navbar-menu">
                <span id="userGreeting"></span>
                <a href="/dashboard">My Dashboard</a>
                <a href="/admin">Admin Panel</a>
                <button onclick="logout()" class="btn btn-secondary btn-sm">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container" style="padding: 2rem 0;">
        <div class="dashboard-header">
            <h1>üõ°Ô∏è Admin Dashboard</h1>
            <p>Monitor dan kelola semua API Keys, Users & System</p>
            <div class="alert alert-info" style="margin-top: 1rem;">
                <strong>‚ÑπÔ∏è Selamat Datang, Admin!</strong> Anda memiliki akses penuh untuk mengelola sistem.
            </div>
        </div>

        <!-- Admin Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Total Users</span>
                    <div class="stat-card-icon primary">üë•</div>
                </div>
                <div class="stat-card-value" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Total API Keys</span>
                    <div class="stat-card-icon primary">üîë</div>
                </div>
                <div class="stat-card-value" id="totalApiKeys">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Active Keys</span>
                    <div class="stat-card-icon success">‚úì</div>
                </div>
                <div class="stat-card-value" id="activeApiKeys">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Inactive Keys</span>
                    <div class="stat-card-icon danger">‚úó</div>
                </div>
                <div class="stat-card-value" id="inactiveApiKeys">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Total Requests</span>
                    <div class="stat-card-icon primary">üìä</div>
                </div>
                <div class="stat-card-value" id="totalRequests">0</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">‚ö° Quick Actions</h2>
            </div>
            <div class="admin-actions-grid">
                <button onclick="deleteInactiveKeys()" class="btn btn-danger">
                    üóëÔ∏è Hapus Semua Inactive Keys
                </button>
                <button onclick="refreshData()" class="btn btn-primary">
                    üîÑ Refresh Data
                </button>
                <button onclick="exportData()" class="btn btn-success">
                    üì• Export Data CSV
                </button>
                <button onclick="showSystemInfo()" class="btn btn-secondary">
                    ‚ÑπÔ∏è System Info
                </button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="card">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('apikeys')">
                    üîë API Keys Management
                </button>
                <button class="tab-btn" onclick="switchTab('users')">
                    üë• Users Management
                </button>
                <button class="tab-btn" onclick="switchTab('logs')">
                    üìã Activity Logs
                </button>
            </div>
        </div>

        <!-- API KEYS TAB -->
        <div id="tab-apikeys" class="tab-content active">
            <!-- Filter -->
            <div class="card">
                <div class="filter-container">
                    <div class="form-group">
                        <label>Filter Status:</label>
                        <select id="statusFilter" class="form-control" onchange="loadApiKeys()">
                            <option value="">Semua Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Search User:</label>
                        <input type="text" id="searchUser" class="form-control" placeholder="Cari username atau email..." onkeyup="loadApiKeys()">
                    </div>
                </div>
            </div>

            <!-- All API Keys -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">All API Keys</h2>
                </div>
                <div id="apiKeysTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- USERS TAB -->
        <div id="tab-users" class="tab-content">
            <!-- User Actions -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">User Management Actions</h2>
                </div>
                <div class="admin-actions-grid">
                    <button onclick="showCreateUserModal()" class="btn btn-primary">
                        ‚ûï Create New User
                    </button>
                    <button onclick="exportUsers()" class="btn btn-success">
                        üì• Export Users CSV
                    </button>
                </div>
            </div>

            <!-- All Users -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">All Users</h2>
                </div>
                <div id="usersTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- LOGS TAB -->
        <div id="tab-logs" class="tab-content">
            <!-- Log Filters -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Filter Logs</h2>
                </div>
                <div class="filter-container">
                    <div class="form-group">
                        <label>Date Range:</label>
                        <input type="date" id="logStartDate" class="form-control" onchange="loadLogs()">
                    </div>
                    <div class="form-group">
                        <label>to</label>
                        <input type="date" id="logEndDate" class="form-control" onchange="loadLogs()">
                    </div>
                    <div class="form-group">
                        <label>User:</label>
                        <input type="text" id="logUserFilter" class="form-control" placeholder="Filter by user..." onkeyup="loadLogs()">
                    </div>
                </div>
            </div>

            <!-- Recent Logs -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Activity Logs</h2>
                </div>
                <div id="logsTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="createUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New User</h2>
                <button class="modal-close" onclick="closeModal('createUserModal')">&times;</button>
            </div>
            <form id="createUserForm">
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="newUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="newEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="newPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="newRole" class="form-control">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createUserModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit User</h2>
                <button class="modal-close" onclick="closeModal('editUserModal')">&times;</button>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="editUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="editEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="editRole" class="form-control">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>New Password (leave blank to keep current):</label>
                    <input type="password" id="editPassword" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editUserModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update User</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html>